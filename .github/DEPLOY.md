# Инструкция по настройке деплоя

## Настройка GitHub Secrets

В настройках репозитория GitHub (`Settings` → `Secrets and variables` → `Actions`) добавьте следующие секреты:

1. **SSH_PRIVATE_KEY** - приватный SSH ключ для доступа к серверу
2. **SERVER_USER** - имя пользователя на сервере (например, `root` или `deploy`)
3. **SERVER_HOST** - IP адрес или домен сервера (например, `192.168.1.100` или `example.com`)
4. **SERVER_PATH** - путь к директории проекта на сервере (например, `/var/www/barakad`)

## Подготовка сервера

1. Установите Docker и Docker Compose на сервере
2. Создайте директорию для проекта:
   ```bash
   mkdir -p /var/www/barakad
   ```

3. Создайте файл `.env.production` на сервере в директории проекта:
   ```bash
   cd /var/www/barakad
   nano .env.production
   ```
   
   Заполните все необходимые переменные окружения (APP_KEY, DB_*, и т.д.)

4. Настройте SSH доступ:
   - Создайте SSH ключ на вашем локальном компьютере (если еще нет):
     ```bash
     ssh-keygen -t ed25519 -C "github-actions"
     ```
   - Скопируйте публичный ключ на сервер:
     ```bash
     ssh-copy-id user@your-server
     ```
   - Добавьте приватный ключ в GitHub Secrets как `SSH_PRIVATE_KEY`

## Запуск деплоя

Деплой запускается автоматически при пуше в ветки `main` или `master`, или вручную через `Actions` → `Deploy to Production` → `Run workflow`.

## Что делает workflow

1. Клонирует код из репозитория
2. Синхронизирует файлы на сервер через rsync
3. Копирует `.env.production` в `.env`
4. Собирает Docker образы
5. Запускает контейнеры через `docker-compose.prod.yml`
6. Выполняет миграции базы данных
7. Создает симлинк для storage
8. Проверяет доступность сервера

## Важные замечания

- Файл `.env.production` должен быть создан на сервере вручную (он в .gitignore)
- Убедитесь, что на сервере установлены Docker и Docker Compose
- Убедитесь, что порты 80 и 443 свободны на сервере
- После первого деплоя проверьте, что все работает корректно

